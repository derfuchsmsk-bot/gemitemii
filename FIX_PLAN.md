# План исправлений для восстановления генерации изображений

## 1. Диагностика проблемы: Почему не генерируются изображения?

### Потенциальная проблема: Rate Limiting
В `main.py` подключен `RateLimitMiddleware(limit=1.0)`. Это может мешать пользователю быстро отправлять промпт после нажатия кнопки меню.

## 2. Структура исправлений

### Шаг 2: Доработка `main.py`
Файл `main.py` отвечает за запуск и конфигурацию. В нем нужно:
1.  **Улучшить проверку переменных окружения**: При старте проверять наличие `PROJECT_ID` и валидность `REGION`.
2.  **Скорректировать Middleware**: Увеличить лимит или исключить определенные действия.
3.  **Логирование**: Добавить вывод текущей конфигурации (без секретов) при старте для отладки.

### Шаг 3: Исправление `src/handlers/image_gen.py`
Так как мы меняем логику вызова модели (с `GenerativeModel` на `ImageGenerationModel` или правильный вызов Gemini), нужно убедиться, что хендлер корректно обрабатывает возвращаемый результат (объект изображения).

## 3. План действий (Checklist)

3.  [ ] **Оптимизировать `main.py`**:
    *   Добавить `lifespan` для управления ресурсами (вместо устаревшего `@app.on_event("startup")`).
    *   Ослабить `RateLimitMiddleware` (например, до 0.5-0.7 сек или убрать для тестов).

Этот файл служит основой для внесения изменений.
